{% extends 'base/base.html' %}

{% block title %}{{ report.title }} - WARA{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1>üìä {{ report.title }}</h1>
                {% if total_versions > 1 %}
                    <div class="d-flex align-items-center mt-2">
                        <span class="badge bg-info me-2">
                            <i class="fas fa-code-branch"></i> {{ total_versions }} –≤–µ—Ä—Å–∏–π
                        </span>
                        {% if not is_current_latest %}
                            <span class="badge bg-warning me-2">
                                <i class="fas fa-info-circle"></i> –í–µ—Ä—Å–∏—è {{ report.version }}
                            </span>
                        {% else %}
                            <span class="badge bg-success me-2">
                                <i class="fas fa-star"></i> –ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
                            </span>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
            <div class="btn-group" role="group">
                {% if report.file %}
                    <a href="{% url 'reports:download' report.pk %}" class="btn btn-success">
                        üì• –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç
                    </a>
                {% endif %}
                <a href="{% url 'reports:delete' report.pk %}" class="btn btn-danger">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –æ—Ç—á–µ—Ç
                </a>
            </div>
        </div>

        {% if total_versions > 1 %}
            <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –≤–µ—Ä—Å–∏–π -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-code-branch"></i> –í—ã–±–æ—Ä –≤–µ—Ä—Å–∏–∏ –æ—Ç—á–µ—Ç–∞
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <label for="version-selector" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:</label>
                            <select class="form-select" id="version-selector" onchange="changeReportVersion(this.value)">
                                {% for version in all_versions %}
                                    <option value="{{ version.pk }}" {% if version.pk == report.pk %}selected{% endif %}>
                                        v{{ version.version }} - {{ version.generated_date|date:"d.m.Y H:i" }}
                                        {% if version.is_latest_version %} (–ü–æ—Å–ª–µ–¥–Ω—è—è){% endif %}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏—è—Ö:</label>
                            <div class="alert alert-light">
                                <small>
                                    <strong>–í—Å–µ–≥–æ –≤–µ—Ä—Å–∏–π:</strong> {{ total_versions }}<br>
                                    <strong>–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:</strong> v{{ report.version }}<br>
                                    <strong>–ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è:</strong> v{{ latest_version.version }}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç—á–µ—Ç–µ</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm">
                            <tr>
                                <td><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong></td>
                                <td>{{ report.title }}</td>
                            </tr>
                            <tr>
                                <td><strong>–§–æ—Ä–º–∞—Ç:</strong></td>
                                <td>
                                    <span class="badge bg-primary">{{ report.get_format_display }}</span>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>–í–µ—Ä—Å–∏—è:</strong></td>
                                <td>
                                    <span class="badge bg-secondary">v{{ report.version }}</span>
                                    {% if report.is_latest_version %}
                                        <span class="badge bg-success ms-1">–ü–æ—Å–ª–µ–¥–Ω—è—è</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td><strong>–°—Ç–∞—Ç—É—Å:</strong></td>
                                <td>
                                    {% if report.status == 'generating' %}
                                        <span class="badge bg-warning">–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è</span>
                                    {% elif report.status == 'ready' %}
                                        <span class="badge bg-success">–ì–æ—Ç–æ–≤</span>
                                    {% elif report.status == 'sent' %}
                                        <span class="badge bg-info">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</span>
                                    {% elif report.status == 'error' %}
                                        <span class="badge bg-danger">–û—à–∏–±–∫–∞</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td><strong>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:</strong></td>
                                <td>
                                    <a href="{% url 'analysis:detail' report.comparison.pk %}">
                                        {{ report.comparison.title }}
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>–î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</strong></td>
                                <td>{{ report.generated_date|date:"d.m.Y H:i" }}</td>
                            </tr>
                            {% if report.sent_date %}
                                <tr>
                                    <td><strong>–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:</strong></td>
                                    <td>{{ report.sent_date|date:"d.m.Y H:i" }}</td>
                                </tr>
                            {% endif %}
                            {% if report.generation_time %}
                                <tr>
                                    <td><strong>–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</strong></td>
                                    <td>{{ report.generation_time }} —Å–µ–∫</td>
                                </tr>
                            {% endif %}
                            {% if report.file_size %}
                                <tr>
                                    <td><strong>–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:</strong></td>
                                    <td>{{ report.get_file_size_mb }} –ú–ë</td>
                                </tr>
                            {% endif %}
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm">
                            <tr>
                                <td><strong>–®–∞–±–ª–æ–Ω:</strong></td>
                                <td>{{ report.template_used }}</td>
                            </tr>
                            <tr>
                                <td><strong>–í–∫–ª—é—á–∏—Ç—å —Å–≤–æ–¥–∫—É:</strong></td>
                                <td>
                                    {% if report.include_summary %}
                                        <span class="badge bg-success">–î–∞</span>
                                    {% else %}
                                        <span class="badge bg-secondary">–ù–µ—Ç</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td><strong>–í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏:</strong></td>
                                <td>
                                    {% if report.include_details %}
                                        <span class="badge bg-success">–î–∞</span>
                                    {% else %}
                                        <span class="badge bg-secondary">–ù–µ—Ç</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td><strong>–í–∫–ª—é—á–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã:</strong></td>
                                <td>
                                    {% if report.include_tables %}
                                        <span class="badge bg-success">–î–∞</span>
                                    {% else %}
                                        <span class="badge bg-secondary">–ù–µ—Ç</span>
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        {% if report.email_recipients %}
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>üìß Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>–°—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏:</strong>
                                    {% if report.email_sent %}
                                        <span class="badge bg-success">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</span>
                                    {% else %}
                                        <span class="badge bg-warning">–ù–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</span>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    <strong>–ü–æ–ª—É—á–∞—Ç–µ–ª–∏:</strong>
                                    <ul class="list-unstyled">
                                        {% for recipient in report.email_recipients %}
                                            <li><small>{{ recipient }}</small></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        {% if report.summary_data %}
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>üìà –î–∞–Ω–Ω—ã–µ —Å–≤–æ–¥–∫–∏</h5>
                        </div>
                        <div class="card-body">
                            <div class="bg-light p-3 rounded">
                                <pre>{{ report.summary_data|pprint }}</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
        </div>

        {% if analysis_data %}
            <!-- –†–∞–∑–¥–µ–ª—ã –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>üîç –†–∞–∑–¥–µ–ª—ã –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h5>
                </div>
                <div class="card-body">
                    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º -->
                    <ul class="nav nav-tabs" id="analysisTabs" role="tablist">
                        {% if analysis_data.summary %}
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summary" type="button" role="tab">
                                    <i class="fas fa-list-ul"></i> –†–µ–∑—é–º–µ
                                </button>
                            </li>
                        {% endif %}
                        {% if analysis_data.similarities %}
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="similarities-tab" data-bs-toggle="tab" data-bs-target="#similarities" type="button" role="tab">
                                    <i class="fas fa-equals"></i> –°—Ö–æ–¥—Å—Ç–≤–∞
                                </button>
                            </li>
                        {% endif %}
                        {% if analysis_data.differences %}
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="differences-tab" data-bs-toggle="tab" data-bs-target="#differences" type="button" role="tab">
                                    <i class="fas fa-not-equal"></i> –†–∞–∑–ª–∏—á–∏—è
                                </button>
                            </li>
                        {% endif %}
                        {% if analysis_data.recommendations %}
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="recommendations-tab" data-bs-toggle="tab" data-bs-target="#recommendations" type="button" role="tab">
                                    <i class="fas fa-lightbulb"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                                </button>
                            </li>
                        {% endif %}
                        {% if analysis_data.analysis_type == 'ollama' %}
                            {% if analysis_data.base_document_sentiment or analysis_data.compared_document_sentiment %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="sentiment-tab" data-bs-toggle="tab" data-bs-target="#sentiment" type="button" role="tab">
                                        <i class="fas fa-heart"></i> –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
                                    </button>
                                </li>
                            {% endif %}
                            {% if analysis_data.base_document_key_points or analysis_data.compared_document_key_points %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="keypoints-tab" data-bs-toggle="tab" data-bs-target="#keypoints" type="button" role="tab">
                                        <i class="fas fa-key"></i> –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã
                                    </button>
                                </li>
                            {% endif %}
                        {% endif %}
                        {% if analysis_data.overall_assessment %}
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="assessment-tab" data-bs-toggle="tab" data-bs-target="#assessment" type="button" role="tab">
                                    <i class="fas fa-star"></i> –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞
                                </button>
                            </li>
                        {% endif %}
                    </ul>

                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–∞–∑–¥–µ–ª–æ–≤ -->
                    <div class="tab-content" id="analysisTabsContent">
                        {% if analysis_data.summary %}
                            <div class="tab-pane fade show active" id="summary" role="tabpanel">
                                <div class="mt-3">
                                    <h6><i class="fas fa-list-ul text-primary"></i> –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –∞–Ω–∞–ª–∏–∑–∞</h6>
                                    <div class="alert alert-info">
                                        {{ analysis_data.summary }}
                                    </div>
                                </div>
                            </div>
                        {% endif %}

                        {% if analysis_data.similarities %}
                            <div class="tab-pane fade" id="similarities" role="tabpanel">
                                <div class="mt-3">
                                    <h6><i class="fas fa-equals text-success"></i> –°—Ö–æ–¥—Å—Ç–≤–∞ –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏</h6>
                                    <ul class="list-group">
                                        {% for similarity in analysis_data.similarities %}
                                            <li class="list-group-item">
                                                <i class="fas fa-check text-success"></i> {{ similarity }}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        {% endif %}

                        {% if analysis_data.differences %}
                            <div class="tab-pane fade" id="differences" role="tabpanel">
                                <div class="mt-3">
                                    <h6><i class="fas fa-not-equal text-warning"></i> –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏</h6>
                                    <div class="accordion" id="differencesAccordion">
                                        {% for difference in analysis_data.differences %}
                                            {% if difference.type %}
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}">
                                                            <span class="badge bg-warning me-2">{{ difference.type|title }}</span>
                                                            {{ difference.description|truncatechars:50 }}
                                                        </button>
                                                    </h2>
                                                    <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" data-bs-parent="#differencesAccordion">
                                                        <div class="accordion-body">
                                                            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ difference.description }}</p>
                                                            {% if difference.location %}
                                                                <p><strong>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> {{ difference.location }}</p>
                                                            {% endif %}
                                                            {% if difference.old_value %}
                                                                <p><strong>–°—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</strong> {{ difference.old_value }}</p>
                                                            {% endif %}
                                                            {% if difference.new_value %}
                                                                <p><strong>–ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</strong> {{ difference.new_value }}</p>
                                                            {% endif %}
                                                            {% if difference.significance %}
                                                                <p><strong>–ó–Ω–∞—á–∏–º–æ—Å—Ç—å:</strong> 
                                                                    <span class="badge 
                                                                        {% if difference.significance == 'high' %}bg-danger
                                                                        {% elif difference.significance == 'medium' %}bg-warning
                                                                        {% else %}bg-secondary{% endif %}">
                                                                        {{ difference.significance|title }}
                                                                    </span>
                                                                </p>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            {% else %}
                                                <div class="alert alert-warning">
                                                    <i class="fas fa-exclamation-triangle"></i> {{ difference }}
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}

                        {% if analysis_data.recommendations %}
                            <div class="tab-pane fade" id="recommendations" role="tabpanel">
                                <div class="mt-3">
                                    <h6><i class="fas fa-lightbulb text-info"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h6>
                                    <div class="row">
                                        {% for recommendation in analysis_data.recommendations %}
                                            <div class="col-md-6 mb-3">
                                                <div class="card border-info">
                                                    <div class="card-body">
                                                        <i class="fas fa-lightbulb text-info"></i> {{ recommendation }}
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}

                        {% if analysis_data.analysis_type == 'ollama' %}
                            {% if analysis_data.base_document_sentiment or analysis_data.compared_document_sentiment %}
                                <div class="tab-pane fade" id="sentiment" role="tabpanel">
                                    <div class="mt-3">
                                        <h6><i class="fas fa-heart text-danger"></i> –ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</h6>
                                        
                                        {% if analysis_data.base_document_sentiment %}
                                            <div class="mb-4">
                                                <h6 class="text-primary">{{ analysis_data.base_document.title }} (v{{ analysis_data.base_document.version }})</h6>
                                                {% if analysis_data.base_document_sentiment.sentiment %}
                                                    <p><strong>–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:</strong> 
                                                        <span class="badge 
                                                            {% if analysis_data.base_document_sentiment.sentiment == 'positive' %}bg-success
                                                            {% elif analysis_data.base_document_sentiment.sentiment == 'negative' %}bg-danger
                                                            {% else %}bg-secondary{% endif %}">
                                                            {{ analysis_data.base_document_sentiment.sentiment|title }}
                                                        </span>
                                                    </p>
                                                {% endif %}
                                                {% if analysis_data.base_document_sentiment.confidence %}
                                                    <p><strong>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</strong> {{ analysis_data.base_document_sentiment.confidence|floatformat:2 }}</p>
                                                {% endif %}
                                                {% if analysis_data.base_document_sentiment.emotions %}
                                                    <p><strong>–≠–º–æ—Ü–∏–∏:</strong> 
                                                        {% for emotion in analysis_data.base_document_sentiment.emotions %}
                                                            <span class="badge bg-info me-1">{{ emotion }}</span>
                                                        {% endfor %}
                                                    </p>
                                                {% endif %}
                                                {% if analysis_data.base_document_sentiment.summary %}
                                                    <div class="alert alert-light">
                                                        {{ analysis_data.base_document_sentiment.summary }}
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% endif %}

                                        {% if analysis_data.compared_document_sentiment %}
                                            <div class="mb-4">
                                                <h6 class="text-primary">{{ analysis_data.compared_document.title }} (v{{ analysis_data.compared_document.version }})</h6>
                                                {% if analysis_data.compared_document_sentiment.sentiment %}
                                                    <p><strong>–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:</strong> 
                                                        <span class="badge 
                                                            {% if analysis_data.compared_document_sentiment.sentiment == 'positive' %}bg-success
                                                            {% elif analysis_data.compared_document_sentiment.sentiment == 'negative' %}bg-danger
                                                            {% else %}bg-secondary{% endif %}">
                                                            {{ analysis_data.compared_document_sentiment.sentiment|title }}
                                                        </span>
                                                    </p>
                                                {% endif %}
                                                {% if analysis_data.compared_document_sentiment.confidence %}
                                                    <p><strong>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</strong> {{ analysis_data.compared_document_sentiment.confidence|floatformat:2 }}</p>
                                                {% endif %}
                                                {% if analysis_data.compared_document_sentiment.emotions %}
                                                    <p><strong>–≠–º–æ—Ü–∏–∏:</strong> 
                                                        {% for emotion in analysis_data.compared_document_sentiment.emotions %}
                                                            <span class="badge bg-info me-1">{{ emotion }}</span>
                                                        {% endfor %}
                                                    </p>
                                                {% endif %}
                                                {% if analysis_data.compared_document_sentiment.summary %}
                                                    <div class="alert alert-light">
                                                        {{ analysis_data.compared_document_sentiment.summary }}
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endif %}

                            {% if analysis_data.base_document_key_points or analysis_data.compared_document_key_points %}
                                <div class="tab-pane fade" id="keypoints" role="tabpanel">
                                    <div class="mt-3">
                                        <h6><i class="fas fa-key text-warning"></i> –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã</h6>
                                        
                                        {% if analysis_data.base_document_key_points %}
                                            <div class="mb-4">
                                                <h6 class="text-primary">{{ analysis_data.base_document.title }} (v{{ analysis_data.base_document.version }})</h6>
                                                {% if analysis_data.base_document_key_points.key_points %}
                                                    <div class="row">
                                                        {% for point in analysis_data.base_document_key_points.key_points %}
                                                            <div class="col-md-6 mb-3">
                                                                <div class="card border-warning">
                                                                    <div class="card-body">
                                                                        <h6 class="card-title">
                                                                            <span class="badge 
                                                                                {% if point.importance == 'high' %}bg-danger
                                                                                {% elif point.importance == 'medium' %}bg-warning
                                                                                {% else %}bg-secondary{% endif %}">
                                                                                {{ point.importance|title }}
                                                                            </span>
                                                                            {% if point.category %}
                                                                                <span class="badge bg-info">{{ point.category }}</span>
                                                                            {% endif %}
                                                                        </h6>
                                                                        <p class="card-text">{{ point.point }}</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endfor %}
                                                    </div>
                                                {% endif %}
                                                {% if analysis_data.base_document_key_points.summary %}
                                                    <div class="alert alert-light">
                                                        <strong>–†–µ–∑—é–º–µ:</strong> {{ analysis_data.base_document_key_points.summary }}
                                                    </div>
                                                {% endif %}
                                                {% if analysis_data.base_document_key_points.main_topics %}
                                                    <p><strong>–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:</strong> 
                                                        {% for topic in analysis_data.base_document_key_points.main_topics %}
                                                            <span class="badge bg-primary me-1">{{ topic }}</span>
                                                        {% endfor %}
                                                    </p>
                                                {% endif %}
                                            </div>
                                        {% endif %}

                                        {% if analysis_data.compared_document_key_points %}
                                            <div class="mb-4">
                                                <h6 class="text-primary">{{ analysis_data.compared_document.title }} (v{{ analysis_data.compared_document.version }})</h6>
                                                {% if analysis_data.compared_document_key_points.key_points %}
                                                    <div class="row">
                                                        {% for point in analysis_data.compared_document_key_points.key_points %}
                                                            <div class="col-md-6 mb-3">
                                                                <div class="card border-warning">
                                                                    <div class="card-body">
                                                                        <h6 class="card-title">
                                                                            <span class="badge 
                                                                                {% if point.importance == 'high' %}bg-danger
                                                                                {% elif point.importance == 'medium' %}bg-warning
                                                                                {% else %}bg-secondary{% endif %}">
                                                                                {{ point.importance|title }}
                                                                            </span>
                                                                            {% if point.category %}
                                                                                <span class="badge bg-info">{{ point.category }}</span>
                                                                            {% endif %}
                                                                        </h6>
                                                                        <p class="card-text">{{ point.point }}</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endfor %}
                                                    </div>
                                                {% endif %}
                                                {% if analysis_data.compared_document_key_points.summary %}
                                                    <div class="alert alert-light">
                                                        <strong>–†–µ–∑—é–º–µ:</strong> {{ analysis_data.compared_document_key_points.summary }}
                                                    </div>
                                                {% endif %}
                                                {% if analysis_data.compared_document_key_points.main_topics %}
                                                    <p><strong>–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:</strong> 
                                                        {% for topic in analysis_data.compared_document_key_points.main_topics %}
                                                            <span class="badge bg-primary me-1">{{ topic }}</span>
                                                        {% endfor %}
                                                    </p>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endif %}
                        {% endif %}

                        {% if analysis_data.overall_assessment %}
                            <div class="tab-pane fade" id="assessment" role="tabpanel">
                                <div class="mt-3">
                                    <h6><i class="fas fa-star text-warning"></i> –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π</h6>
                                    <div class="alert alert-warning">
                                        <i class="fas fa-star"></i> {{ analysis_data.overall_assessment }}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endif %}

        <script>
function changeReportVersion(versionId) {
    if (versionId) {
        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
        window.location.href = '/reports/' + versionId + '/';
    }
}
</script>
{% endblock %}
