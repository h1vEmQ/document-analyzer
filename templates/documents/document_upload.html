{% extends 'base/base.html' %}

{% block title %}–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h4>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="{{ form.existing_document.id_for_label }}" class="form-label">
                            {{ form.existing_document.label }}
                        </label>
                        {{ form.existing_document }}
                        {% if form.existing_document.errors %}
                            <div class="text-danger">
                                {% for error in form.existing_document.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            –í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç"
                        </div>
                    </div>
                    
                    <div class="mb-3" id="title-field">
                        <label for="{{ form.title.id_for_label }}" class="form-label">
                            {{ form.title.label }}
                        </label>
                        {{ form.title }}
                        {% if form.title.errors %}
                            <div class="text-danger">
                                {% for error in form.title.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –Ω–∞–∑–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∑—è—Ç–æ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
                        </div>
                    </div>
                    
                    <div class="mb-3" id="version-notes-field">
                        <label for="{{ form.version_notes.id_for_label }}" class="form-label">
                            {{ form.version_notes.label }}
                        </label>
                        {{ form.version_notes }}
                        {% if form.version_notes.errors %}
                            <div class="text-danger">
                                {% for error in form.version_notes.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            –û–ø–∏—à–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.file.id_for_label }}" class="form-label">
                            {{ form.file.label }}
                        </label>
                        {{ form.file }}
                        {% if form.file.errors %}
                            <div class="text-danger">
                                {% for error in form.file.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã .docx —Ä–∞–∑–º–µ—Ä–æ–º –¥–æ 10 –ú–ë
                        </div>
                        <div class="alert alert-info mt-2">
                            <i class="fas fa-info-circle"></i>
                            <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:</strong> –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ, —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ —Ç–∞–±–ª–∏—Ü.
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'documents:list' %}" class="btn btn-secondary me-md-2">
                            –û—Ç–º–µ–Ω–∞
                        </a>
                        <button type="submit" class="btn btn-primary">
                            üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const existingDocumentSelect = document.getElementById('id_existing_document');
    const titleField = document.getElementById('title-field');
    const versionNotesField = document.getElementById('version-notes-field');
    const titleInput = document.getElementById('id_title');
    
    function toggleFields() {
        const isExistingDocument = existingDocumentSelect.value !== '';
        
        if (isExistingDocument) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –∑–∞–º–µ—Ç–æ–∫ –∫ –≤–µ—Ä—Å–∏–∏
            versionNotesField.style.display = 'block';
            
            // –î–µ–ª–∞–µ–º –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –µ–≥–æ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            const selectedOption = existingDocumentSelect.options[existingDocumentSelect.selectedIndex];
            if (selectedOption.value) {
                titleInput.value = selectedOption.text;
                titleInput.readOnly = true;
                titleInput.style.backgroundColor = '#f8f9fa';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º label
                const titleLabel = titleField.querySelector('label');
                titleLabel.textContent = '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–æ)';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                const formText = titleField.querySelector('.form-text');
                formText.textContent = '–ù–∞–∑–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∑—è—Ç–æ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞';
            }
        } else {
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –∑–∞–º–µ—Ç–æ–∫ –∫ –≤–µ—Ä—Å–∏–∏
            versionNotesField.style.display = 'none';
            
            // –î–µ–ª–∞–µ–º –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º
            titleInput.readOnly = false;
            titleInput.style.backgroundColor = '';
            titleInput.value = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º label
            const titleLabel = titleField.querySelector('label');
            titleLabel.textContent = '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
            const formText = titleField.querySelector('.form-text');
            formText.textContent = '–ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –Ω–∞–∑–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∑—è—Ç–æ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞';
        }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    toggleFields();
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    existingDocumentSelect.addEventListener('change', toggleFields);
});
</script>
{% endblock %}
{% endblock %}
