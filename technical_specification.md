# Техническое задание
## Система анализа документов (Report analyzer)

### 1. Общее описание

**Наименование проекта:** Weekly Activity Report Analyzer (WARA)  
**Тип системы:** Полнофункциональное веб-приложение для автоматического анализа и сравнения документов с системой управления пользователями  
**Цель:** Автоматизация процесса анализа изменений в документах, составления отчетов по различиям между версиями с доставкой результатов по электронной почте и управлением пользователями  
**Статус:** ✅ ПОЛНОСТЬЮ РЕАЛИЗОВАНО И РАБОТАЕТ

**НОВЫЕ ВОЗМОЖНОСТИ:**
- ✅ Админ-панель с управлением пользователями
- ✅ Настройки приложения и сервера
- ✅ Мониторинг системы с интерактивными графиками
- ✅ Версионирование документов
- ✅ Режимы просмотра
- ✅ Автоматические функции

### 2. Функциональные требования

#### 2.1 Основной функционал

**2.1.1 Загрузка и обработка документов**
- Загрузка файлов в формате .docx (размер до 10 МБ)
- Обработка одного документа за раз
- Валидация формата и целостности документов
- Извлечение текстового содержимого и таблиц
- Сохранение структуры документа (заголовки, списки)

**2.1.2 Базовая версия отчета**
- Выбор базовой версии отчета для сравнения
- Возможность установки нескольких базовых версий
- Автоматическое определение последней версии

**2.1.3 Анализ изменений**
- Сравнение текстового содержимого между версиями
- Выявление добавленного, удаленного и измененного контента
- Анализ изменений в таблицах
- Отслеживание изменений в заголовках и структуре документа
- Обнаружение изменений в числовых данных

**2.1.4 Составление доклада**
- Автоматическое формирование доклада по изменениям
- Структурированное представление изменений по разделам
- Создание сводной таблицы изменений
- Экспорт доклада в PDF формат
- **Автоматическая отправка доклада по электронной почте**

#### 2.2 Дополнительный функционал

**2.2.1 Базовая настройка**
- Настройка чувствительности к изменениям
- Фильтрация по типам изменений (текст, числа)

**2.2.2 История операций**
- Сохранение истории сравнений
- Возможность возврата к предыдущим анализам

**2.2.3 Базовые возможности**
- **Многопользовательский режим** с базовыми ролями
- **Автоматическая отправка докладов по email**

### 3. Технические требования

#### 3.1 Архитектура системы

**3.1.1 Тип архитектуры:** Серверное приложение с веб-интерфейсом

**3.1.2 Компоненты системы:**
- Модуль загрузки и парсинга документов
- Модуль анализа и сравнения
- Модуль генерации отчетов
- Модуль управления данными
- Модуль отправки email уведомлений
- Простой веб-интерфейс

#### 3.2 Технологический стек

**3.2.1 Backend (упрощенный для РЕДОС 7.3):**
- **Язык программирования:** Python 3.9+ (из репозитория РЕДОС)
- **Фреймворк:** Django (стандартная версия)
- **Библиотеки для работы с Word:**
  - `python-docx` - для парсинга .docx файлов
  - `diff-match-patch` - для сравнения текстов
  - `ReportLab` - для генерации PDF
- **База данных:** SQLite (встроенная в Django)
- **Email:** встроенный SMTP Django
- **Веб-сервер:** Apache HTTP Server 2.4+ (стандартный для РЕДОС)

**3.2.2 Frontend (упрощенный):**
- **Фреймворк:** Django Templates (встроенные в Django)
- **UI библиотека:** Bootstrap 5
- **JavaScript:** Vanilla JS для базовой интерактивности

**3.2.3 Серверная инфраструктура (упрощенная для РЕДОС 7.3):**
- **Веб-сервер:** Apache HTTP Server 2.4+ с mod_wsgi
- **Логирование:** rsyslog (стандартный для РЕДОС)
- **Файрвол:** firewalld (стандартный для РЕДОС)
- **SELinux:** принудительный режим (обязательно для РЕДОС)

#### 3.3 Системные требования

**3.3.1 Серверные требования (минимальные):**
- RAM: 8 GB
- Процессор: Intel Core i5 или эквивалент (4 ядра)
- Свободное место: 30 GB (SSD)
- **Операционная система: РЕДОС 7.3**
- Сетевое подключение: стабильный интернет
- Поддержка аппаратного ускорения для шифрования

**3.3.2 Серверные требования (рекомендуемые):**
- RAM: 16 GB
- Процессор: Intel Core i7 или эквивалент (8 ядер)
- Свободное место: 100 GB (SSD)
- Резервное копирование: автоматическое
- Мониторинг: 24/7
- **Сертифицированное оборудование для РЕДОС 7.3**

**3.3.3 Клиентские требования:**
- Браузер: Chrome 90+, Firefox 88+, Safari 14+
- Доступ к интернету для веб-интерфейса
- Email клиент для получения отчетов

### 4. Структура данных

#### 4.1 Модель документа
```python
class Document:
    id: str
    filename: str
    upload_date: datetime
    version: str
    content: dict  # {sections: [], tables: [], images: [], metadata: {}}
    checksum: str
    file_size: int  # до 10 МБ
    user_id: str  # для многопользовательского режима
    status: str  # uploaded, processing, processed, error
```

#### 4.2 Модель сравнения
```python
class Comparison:
    id: str
    base_document_id: str
    compared_document_id: str
    comparison_date: datetime
    changes: list  # [{type, section, old_value, new_value, confidence, topic_changes}]
    summary: dict  # {added: int, removed: int, modified: int, topics_added: int, topics_removed: int}
    processing_time: float
    user_id: str
```

#### 4.3 Модель отчета
```python
class Report:
    id: str
    comparison_id: str
    title: str
    generated_date: datetime
    format: str  # pdf, docx, xlsx
    file_path: str
    summary: dict
    email_sent: bool
    email_recipients: list
    template_used: str
    user_id: str
```

#### 4.4 Модель пользователя
```python
class User:
    id: str
    username: str
    email: str
    role: str  # admin, manager, viewer
    created_date: datetime
    is_active: bool
    notification_settings: dict
```

### 5. Пользовательский интерфейс

#### 5.1 Главная страница (для руководителей)
- Область для загрузки файлов (drag & drop)
- Список загруженных документов с статусом обработки
- Кнопка запуска анализа
- Прогресс-бар обработки
- История последних анализов
- Уведомления о готовых отчетах

#### 5.2 Страница сравнения
- Выбор базового документа
- Выбор сравниваемых документов
- Настройки анализа
- Предварительный просмотр изменений

#### 5.3 Страница результатов
- Сводка изменений
- Детальный список изменений по разделам
- Визуализация изменений (графики, диаграммы)
- Кнопки экспорта результатов

#### 5.4 Страница настроек
- Настройки чувствительности анализа
- Фильтры типов изменений
- Настройки экспорта
- Управление базовыми документами
- Настройки email уведомлений
- Управление шаблонами отчетов
- Настройки пользователей и ролей (для администраторов)

### 6. Алгоритм анализа изменений

#### 6.1 Этапы обработки
1. **Извлечение структуры:** Парсинг заголовков, разделов, таблиц, изображений
2. **Нормализация текста:** Удаление лишних пробелов, приведение к единому формату
3. **Сравнение по разделам:** Построчное сравнение текста в каждом разделе
4. **Анализ таблиц:** Сравнение ячеек, выявление изменений в числовых данных (включая Excel таблицы)
5. **Анализ изображений:** Сравнение диаграмм и графиков с помощью компьютерного зрения
6. **Анализ тем отчета:** Выявление изменений в количестве и структуре разделов
7. **Вычисление метрик:** Подсчет статистики изменений
8. **Генерация отчета:** Формирование структурированного доклада
9. **Отправка по email:** Автоматическая доставка результата пользователям

#### 6.2 Типы изменений
- **Добавление:** Новые разделы, абзацы, строки в таблицах, новые темы отчета
- **Удаление:** Удаленные разделы, абзацы, строки, исчезнувшие темы
- **Изменение:** Модифицированный текст, измененные значения в таблицах, обновленные цифры
- **Перемещение:** Изменение порядка разделов или строк
- **Форматирование:** Изменения в стилях, шрифтах, выравнивании
- **Изменения в изображениях:** Новые диаграммы, измененные графики, обновленные изображения
- **Структурные изменения:** Изменения в количестве тем, перестройка разделов

### 7. Требования к производительности

#### 7.1 Временные ограничения
- Загрузка документа (10MB): не более 30 секунд
- Анализ пары документов (50 страниц каждый): не более 5 минут
- Генерация отчета: не более 2 минут
- Экспорт в PDF: не более 1 минуты
- Отправка email уведомления: не более 30 секунд

#### 7.2 Ограничения ресурсов
- Максимальный размер файла: 10 MB (согласно требованиям)
- Максимальное количество одновременно обрабатываемых документов: 1 (согласно требованиям)
- Максимальная длина текста для анализа: 500,000 символов
- Максимальное количество пользователей: 100
- Время хранения обработанных документов: 90 дней

### 8. Требования к безопасности

#### 8.1 Защита данных (адаптированная для РЕДОС 7.3)
- Шифрование файлов при хранении (AES-256)
- Автоматическое удаление временных файлов
- Логирование всех операций с аудитом (через rsyslog)
- Резервное копирование данных
- Аутентификация пользователей (JWT токены)
- Авторизация по ролям (admin, manager, viewer)
- **SELinux политики** для изоляции процессов
- **Мандатное управление доступом (MAC)** через SELinux
- **Дискреционное управление доступом (DAC)** через стандартные права файлов
- **Аудит безопасности** через auditd
- **Шифрование дисков** с помощью LUKS

#### 8.2 Конфиденциальность и соответствие требованиям РЕДОС
- Обработка документов в изолированной среде
- Отсутствие передачи данных третьим лицам
- Возможность работы в офлайн режиме
- Шифрование email уведомлений
- Соблюдение GDPR требований
- **Соответствие требованиям ФСТЭК России**
- **Сертификация по классам защищенности** (КСЗ)
- **Изоляция сетевого трафика** через firewalld
- **Контроль целостности** файлов и процессов
- **Защита от несанкционированного доступа** на уровне ОС

### 9. Этапы разработки

#### Этап 1 (6 недель): MVP на РЕДОС 7.3
- Базовая загрузка и парсинг .docx файлов
- Простое сравнение текстового содержимого
- Генерация PDF отчета об изменениях
- Простой веб-интерфейс (Django Templates)
- Базовая система пользователей
- Email уведомления
- **Базовая настройка SELinux**

#### Этап 2 (4 недели): Дополнительный функционал
- Анализ таблиц в документах
- Улучшенный алгоритм сравнения
- Многопользовательский режим
- История операций
- **Настройка безопасности РЕДОС**

#### Этап 3 (2 недели): Тестирование и документация
- Тестирование и исправление ошибок
- Документация пользователя
- Базовое тестирование безопасности

### 10. Критерии приемки

#### 10.1 Функциональные критерии
- Корректная обработка документов размером до 10 МБ
- Точность выявления изменений не менее 90%
- Стабильная работа при обработке одного документа за раз
- Генерация PDF отчетов
- Автоматическая отправка отчетов по email
- Корректная работа многопользовательского режима

#### 10.2 Технические критерии
- Соответствие требованиям к производительности
- Отсутствие критических ошибок при тестировании
- Корректная работа серверного приложения на РЕДОС 7.3
- Безопасность данных и соответствие требованиям конфиденциальности
- **Корректная работа SELinux в принудительном режиме**

### 11. Заключение

Данное техническое задание описывает требования к разработке упрощенного серверного приложения для автоматизированного анализа изменений в еженедельных отчетах о текущей деятельности. Система обеспечивает базовую точность выявления различий между документами с автоматической доставкой результатов по электронной почте.

**Основные особенности упрощенной системы:**
- Серверная архитектура с простым веб-интерфейсом на **РЕДОС 7.3**
- Многопользовательский режим с базовыми ролями
- Анализ текста и таблиц в документах
- Автоматическая отправка отчетов по email
- **Базовые требования к безопасности РЕДОС**

**Общая оценка трудозатрат:** 12 недель разработки  
**Команда разработки:** 2-3 разработчика  
**Бюджет:** Средний уровень сложности проекта
