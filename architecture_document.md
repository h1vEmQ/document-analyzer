# Архитектура упрощенной системы анализа отчетов Word

## 1. Общая архитектура системы

### 1.1 Архитектурный стиль
Система построена по принципу **многоуровневой архитектуры (N-tier)** с использованием **монолитного подхода** на базе Django.

### 1.2 Основные принципы
- **Простота и надежность** архитектуры
- **Синхронная обработка** документов
- **Минимальная сложность** развертывания
- **Базовые требования безопасности** РЕДОС 7.3

## 2. Уровни архитектуры

### 2.1 Клиентский уровень
**Компоненты:**
- **Веб-интерфейс** (Django Templates + Bootstrap)
- **Email клиенты** для получения отчетов

**Функции:**
- Загрузка документов через формы
- Управление пользователями
- Просмотр результатов анализа
- Получение отчетов по email

### 2.2 Веб-серверный уровень
**Компоненты:**
- **Apache HTTP Server 2.4+** с mod_wsgi
- **SSL/TLS** шифрование
- **Статическое содержимое** (CSS, JS, изображения)

**Функции:**
- Обработка HTTP запросов
- SSL терминация
- Балансировка нагрузки
- Кэширование статического контента

### 2.3 Прикладной уровень (Django)

#### 2.3.1 Django Framework
**Компоненты:**
- **Django** веб-фреймворк
- **Django Authentication** система
- **Django Templates** для интерфейса
- **Django Forms** для валидации

**Функции:**
- Аутентификация и авторизация
- Обработка HTTP запросов
- Валидация входных данных
- Рендеринг шаблонов

#### 2.3.2 Бизнес-логика (Django Apps)
**Компоненты:**
- **Модуль загрузки документов** (Django App)
- **Модуль парсинга** Word документов
- **Модуль анализа изменений**
- **Модуль генерации отчетов**
- **Email сервис уведомлений**

**Функции:**
- Синхронная обработка бизнес-логики
- Управление моделями данных
- Обработка форм и запросов

### 2.4 Уровень данных
**Компоненты:**
- **SQLite** (встроенная БД Django)
- **Файловое хранилище** документов
- **Django File Storage** для управления файлами

**Функции:**
- Хранение структурированных данных
- Хранение файлов документов
- Управление медиафайлами

### 2.5 Системные сервисы
**Компоненты:**
- **Django Email Backend** для отправки email
- **rsyslog** для логирования
- **auditd** для базового аудита
- **firewalld** для сетевой безопасности

**Функции:**
- Отправка email уведомлений
- Базовое логирование
- Аудит безопасности
- Сетевая защита

## 3. Компоненты системы

### 3.1 Модуль загрузки документов
**Ответственность:**
- Валидация формата файлов
- Проверка размера и целостности
- Сохранение в файловое хранилище
- Создание метаданных документа

**Технологии:**
- Django FileField
- python-docx для валидации
- Django Forms для валидации

### 3.2 Модуль парсинга
**Ответственность:**
- Извлечение текста из .docx файлов
- Парсинг базовых таблиц
- Сохранение структуры документа
- Нормализация данных

**Технологии:**
- python-docx для Word документов
- Django Models для хранения данных

### 3.3 Модуль анализа изменений
**Ответственность:**
- Сравнение текстового содержимого
- Анализ изменений в таблицах
- Выявление изменений в числовых данных

**Технологии:**
- diff-match-patch для сравнения текста
- Django Models для хранения результатов

### 3.4 Модуль генерации отчетов
**Ответственность:**
- Создание PDF отчетов
- Применение простых шаблонов
- Экспорт в PDF формат

**Технологии:**
- ReportLab для PDF
- Django Templates для шаблонов

### 3.5 Email сервис
**Ответственность:**
- Отправка отчетов по email
- Обработка ошибок отправки
- Логирование операций

**Технологии:**
- Django Email Backend
- Django Templates для email

## 4. Потоки данных

### 4.1 Загрузка документа
1. Пользователь загружает файл через веб-интерфейс
2. Apache передает файл в API
3. API валидирует файл и сохраняет метаданные в БД
4. Файл сохраняется в зашифрованное хранилище
5. Задача обработки добавляется в очередь Redis
6. Celery Worker получает задачу и обрабатывает документ
7. Результаты сохраняются в БД

### 4.2 Анализ изменений
1. Пользователь запускает сравнение документов
2. API получает параметры и создает задачу анализа
3. Celery Worker выполняет сравнение документов
4. Результаты анализа сохраняются в БД
5. Запускается генерация отчета
6. Отчет сохраняется в файловое хранилище
7. Email сервис отправляет отчет пользователю

### 4.3 Мониторинг и логирование
1. Все операции логируются через rsyslog
2. Система аудита записывает события в auditd
3. Zabbix мониторит производительность системы
4. Grafana отображает метрики и дашборды
5. ELK Stack анализирует логи

## 5. Безопасность

### 5.1 Уровни безопасности
- **Сетевой уровень:** firewalld, VPN
- **Прикладной уровень:** JWT, HTTPS, валидация
- **Системный уровень:** SELinux, auditd
- **Хранилище данных:** LUKS шифрование

### 5.2 SELinux политики
- Изоляция процессов приложения
- Контроль доступа к файлам
- Ограничение сетевых соединений
- Аудит всех операций

### 5.3 Шифрование
- **LUKS** для шифрования дисков
- **SSL/TLS** для сетевого трафика
- **AES-256** для файлов документов
- **JWT** для аутентификации

## 6. Масштабируемость

### 6.1 Горизонтальное масштабирование
- Добавление Celery Workers
- Кластеризация PostgreSQL
- Балансировка нагрузки Apache
- Распределенное хранение файлов

### 6.2 Вертикальное масштабирование
- Увеличение RAM и CPU
- Оптимизация запросов к БД
- Кэширование в Redis
- Сжатие данных

## 7. Отказоустойчивость

### 7.1 Резервное копирование
- Автоматическое копирование БД
- Синхронизация файлового хранилища
- Резервные копии конфигураций
- Тестирование восстановления

### 7.2 Мониторинг
- Zabbix для системного мониторинга
- Grafana для визуализации
- Алерты при критических событиях
- Автоматическое восстановление сервисов

## 8. Развертывание

### 8.1 Инфраструктура
- **Сервер приложений:** РЕДОС 7.3
- **Сервер БД:** РЕДОС 7.3
- **Сервер мониторинга:** РЕДОС 7.3
- **Сетевая инфраструктура:** VLAN, VPN

### 8.2 Контейнеризация
- **Podman** для контейнеров
- **Docker Compose** для оркестрации
- **Изоляция** процессов
- **Управление ресурсами**

### 8.3 CI/CD
- Автоматическое тестирование
- Развертывание в staging
- Продакшн развертывание
- Откат при ошибках

## 9. Соответствие требованиям

### 9.1 ФСТЭК
- Классы защищенности (КСЗ)
- Требования по безопасности
- Аудит и мониторинг
- Документация по безопасности

### 9.2 РЕДОС 7.3
- Совместимость с ОС
- Использование стандартных пакетов
- SELinux политики
- Системные сервисы

## 10. Заключение

Архитектура системы обеспечивает:
- **Высокую производительность** за счет асинхронной обработки
- **Масштабируемость** и отказоустойчивость
- **Безопасность** на всех уровнях
- **Соответствие** требованиям РЕДОС 7.3 и ФСТЭК
- **Простота развертывания** и сопровождения
